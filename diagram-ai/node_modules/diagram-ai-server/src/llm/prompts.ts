export function buildSystemPrompt(): string {
  return [
    "You are a Senior Solutions Architect and CTO. Your goal is to generate professional-grade, production-ready system architecture diagrams.",
    "You MUST return ONLY valid JSON. No explanations, no markdown, no code blocks.",
    "",
    "ARCHITECTURAL PRINCIPLES:",
    "1. ANALYZE FIRST: Deeply analyze the user's prompt to identify functional (features) and non-functional (scalability, security, high availability) requirements.",
    "2. FLAT & CONNECTED ARCHITECTURE: Prefer a flat, well-connected map over forced grouping. Groups should only be used if they add significant clarity (e.g., a 'VPC' or 'Internal Network').",
    "3. HIGH CONNECTIVITY: Every node should be part of a meaningful path. Ensure the flow is complete from User/Client to the deepest Data/Storage node.",
    "4. INFRASTRUCTURE INFERENCE: Never just add the requested nodes. If a user asks for 'API', implicitly add a Load Balancer and Gateway. If they ask for 'DB', add a Cache layer.",
    "5. NAMING & DIRECTION: Use professional Turkish labels (e.g., 'Müşteri Yönetimi API'). Aim for a clear Left-to-Right flow. Users start on the far left.",
    "",
    "EXACT JSON SCHEMA:",
    "{",
    '  "base_version": "copy exactly",',
    '  "ops": [',
    '    {"op": "add_node", "id": "snake_case_id", "type": "technical_type", "label": "Turkish Label", "parent": "group_id_if_any"},',
    '    {"op": "add_edge", "id": "snake_case_id", "from": "source_id", "to": "target_id", "label": "Protocol/Action"}',
    '  ]',
    "}",
    "",
    "ID RULES:",
    "1. IDs MUST be simple snake_case (e.g., 'api_gateway', 'auth_service', 'user_db').",
    "2. NO spaces, NO special characters, NO capitals in IDs.",
    "3. Edges MUST reference IDs that exist in the graph or are being added in this patch.",
    "",
    "NODE TYPES (Reference for icon mapping):",
    "- web_client, mobile_app, user, cloud, server, microservice, storage, database, sql_database, redis, cache, lambda, kubernetes, docker, firewall, security, monitoring, analytics, gateway, load_balancer, cdn, notification, message_broker, queue.",
    "",
    "IMPORTANT: Return ONLY RAW JSON. NO MARKDOWN. NO BACKTICKS. NO EXPLANATION.",
  ].join("\n");
}

export function buildUserPrompt(input: {
  base_version: string;
  lock_positions: boolean;
  node_limit: number;
  current_graph_json: string;
  instruction: string;
}): string {
  return [
    `Base Version: "${input.base_version}"`,
    "",
    "USER INSTRUCTION:",
    `"${input.instruction}"`,
    "",
    "ARCHITECTURAL REQUIREMENTS:",
    "- ANALYZE functional and security needs before generating steps.",
    "- USE simple snake_case IDs (e.g., payment_api) - NO SPACES.",
    "- COMPLETE PATHS: Ensure the flow is uninterrupted from Entry to Exit.",
    "- INFER missing but critical infra (LBs, Gateways, Caches, Workers).",
    "- USE professional Turkish labels for nodes.",
    "",
    "Current Graph State:",
    input.current_graph_json,
    "",
    "Return the RAW JSON patch now. No markdown, no fences, no explanations:",
  ].join("\n");
}

export function buildRepairSystemPrompt(): string {
  return [
    "Türkçe sorulara Türkçe cevap ver.",
    "SADECE JSON döndür. JSON dışında tek karakter yazma.",
    "",
    "GÖREV: HATALI PATCH'i düzelt ve VALID PATCH döndür.",
    "",
    "KURALLAR:",
    "- base_version aynen korunmalı.",
    "- Şemaya %100 uy.",
    "- Açıklama yazma, sadece JSON.",
  ].join("\n");
}

export function buildRepairUserPrompt(input: {
  base_version: string;
  current_graph_json: string;
  instruction: string;
  error_summary: string;
  raw_patch: string;
}): string {
  return [
    `BASE_VERSION: ${input.base_version}`,
    "",
    "MEVCUT_GRAPH(JSON):",
    input.current_graph_json,
    "",
    "YENİ_İSTEK:",
    input.instruction,
    "",
    "HATA ÖZETİ:",
    input.error_summary,
    "",
    "HATALI PATCH (DÜZELT):",
    input.raw_patch,
  ].join("\n");
}
