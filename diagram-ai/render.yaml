services:
  - type: web
    name: diagram-ai-server
    env: node
    rootDir: server
    buildCommand: npm install && npm run build
    startCommand: npm run start
    envVars:
      - key: PORT
        value: 10000
    plan: free

  - type: static
    name: diagram-ai-web
    env: static
    rootDir: web
    buildCommand: npm install && npm run build
    staticPublishPath: ./dist
    envVars:
      - key: VITE_API_URL
        fromService:
          type: web
          name: diagram-ai-server
          property: url
          envVarKey: VITE_API_URL # This might need a trick, usually we just set the URL. But for static sites, we need it at build time.
